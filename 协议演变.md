大家好，我是move。今天整理了一下协议相关内容。

![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)

随着互联网的快速发展，HTTP1.x协议得到了迅猛发展，但当App一个页面包含了数十个请求时，HTTP1.x协议的局限性便暴露了出来：

1) 每个请求与响应需要单独建立链路进行请求(Connection字段能够解决部分问题)，浪费资源。

2) 每个请求与响应都需要添加完整的头信息，应用数据传输效率较低。

3) 默认没有进行加密，数据在传输过程中容易被监听与篡改。


### HTTP2.0历史及其与SPDY的渊源

SPDY协议设定的目标：
  * 页面加载时间（PLT，Page • Load Time）降低 50%；
  * 无需网站作者修改任何内容；
  * 把部署复杂性降至最低，无需变更网络基础设施；
  * 与开源社区合作开发这个新协议；
  * 收集真实性能数据，验证这个实验性协议是否有效。

HTTP-WG（HTTP Working Group）在2012 年初把HTTP 2.0提到了议事日程，吸取SPDY 的经验教训，并在此基础上制定官方标准

  1）SPDY 是谷歌开发的一个实验性协议，于2009 年年中发布，主要目标是通过解决HTTP 1.1 中广为人知的一些性能限制，来减少网页的加载延迟
  
  2）注：为了达到降低50% 页面加载时间的目标，SPDY 引入了一个新的二进制分帧数据层，以实现多向请求和响应、优先次序、最小化及消除不必要的网络延迟，目的是更有效地利用底层TCP 连接；
  
  
### HTTP2.0原理简述

#### 多路复用：

![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.jpg)

多路复用允许同时通过单一的HTTP/2 连接发起多重的请求-响应消息。

http1.1 协议中浏览器在同一时间内，针对同一域名下的请求数量有限制，超过限制数目的请求会被阻塞。

过去，HTTP性能优化不在高宽带，而在低延迟。TCP链接会随着时间自我进行调节，起初会限制最大链接速度，如果数据传输成功，则随着时间推移提高传输速度，这种调节被称为慢启动。由于这种原因，原本具有突发性和短时性的HTTP链接变得十分低效。

ＨＴＴＰ２通过让所有的数据流共用同一个链接，可以更有效的使用ＴＣＰ链接，让宽带也能真正的服务于ＨＴＴＰ的性能提升。

总结：

１）单链接多资源方式，减少服务端的链接压力，内存占用更少，链接吞吐量更大

２）ＴＣＰ链接的减少使得网络拥塞状况可以改善。同时慢启动时间的减少，使拥塞和丢包恢复速度更快



#### HTTP2.0性能增强的核心：二进制分帧

![](https://github.com/moveondo/Front-end-engineering/blob/master/image/2.jpg)

HTTP 2.0最大的特点： 不会改动HTTP 的语义，HTTP 方法、状态码、URI 及首部字段，等等这些核心概念上一如往常，却能致力于突破上一代标准的性能限制，改进传输性能，实现低延迟和高吞吐量。而之所以叫2.0，是在于新增的二进制分帧层。

既然又要保证HTTP的各种动词，方法，首部都不受影响，那就需要在应用层(HTTP2.0)和传输层(TCP or UDP)之间增加一个二进制分帧层。

在二进制分帧层上，HTTP 2.0 会将所有传输的信息分割为更小的消息和帧,并对它们采用二进制格式的编码 ，其中HTTP1.x的首部信息会被封装到Headers帧，而我们的request body则封装到Data帧里面。

然后，HTTP 2.0 通信都在一个连接上完成，这个连接可以承载任意数量的双向数据流。相应地，每个数据流以消息的形式发送，而消息由一或多个帧组成，这些帧可以乱序发送，然后再根据每个帧首部的流标识符重新组装。


#### 首部压缩（Header Compression）

![](https://github.com/moveondo/Front-end-engineering/blob/master/image/3.jpg)

Ｈｔｔｐ１不支持首部压缩，为此ＳＰＤＹ和ＨＴＴＰ２应运而生。

基本原理:

简单的说，HPACK 使用2个索引表(静态索引表和动态索引表)来把头部映射到索引值，并对不存在的头部使用 huffman 编码，并动态缓存到索引，从而达到压缩头部的效果。

#### 服务端推送（Server Push）

![](https://github.com/moveondo/Front-end-engineering/blob/master/image/4.jpg)

HTTP 2.0 新增的一个强大的新功能，就是服务器可以对一个客户端请求发送多个响应。换句话说，除了对最初请求的响应外，服务器还可以额外向客户端推送资源，而无需客户端明确地请求。

有了HTTP2.0的服务器推送，HTTP1.x时代的内嵌资源的优化手段也变得没有意义了。而且使用服务器推送的资源的方式更加高效，因为客户端还可以缓存起来，甚至可以由不同的页面共享（依旧遵循同源策略）

#### 安全

1）HTTPS将是未来的趋势，HTTP/2基于HTTPS也是未来的趋势，安全也是HTTP/2的重要特性之一

2）开启HTTP/2前，请确保HTTPS的证书已经配置成功；若第一次配置HTTPS证书，需要等到证书配置完成并且证书生效后，才能打开HTTP/2。

3）若已经开启了HTTP/2，但是又关闭了https证书功能，HTTP/2会自动失效。



![](https://github.com/moveondo/Front-end-engineering/blob/master/image/2.png)

![](https://github.com/moveondo/Front-end-engineering/blob/master/image/3.png)

![](https://github.com/moveondo/Front-end-engineering/blob/master/image/4.png)

### 比较HTTPS,SPDY,HTTP2

#### 测试#1——请求和响应头的大小


![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
![](https://github.com/moveondo/Front-end-engineering/blob/master/image/1.png)
